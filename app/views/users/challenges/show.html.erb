<div id="navbar">
  <ul class="topnav">
    <li><a class="active" href="/">Home</a></li>
    <li><a href="#friends">Friends</a></li>
    <% if current_user %>
      <li class="right"><%= link_to "Logout", "/logout", method: :delete%></li>
      <li class="right"><%= link_to "Dashboard", "/users/#{current_user.id}/dashboard", method: :get%></li>
      <li class="right"><%= link_to "Pantry", "/users/#{current_user.id}/ingredients", method: :get%></li>
    <% else %>
      <li class="right"><%= link_to "Login with Google", google_oauth2_path%></li>
    <% end %>
  </ul>
</div>
<h1>Solo Challenge!</h1>

<% if @challenge.game_status == "before" %>
  <main class="game-info-main">
    <h2>This is a solo game.  You race against the clock to build a fabulous dish using all the items in your mystery basket.</h2>
    <h2>As soon as you click "Let's Get Choppin'!", Your basket contents will be revealed, your timer will start, and the game will begin!</h2>
    <h2> Your basket will have <%="#{@challenge.basket_size}"%> random ingredients in it.</h2>
    <h2> You're making <%="#{@challenge.meal_type}"%> in this challenge.</h2>
    <h2> You will have <%="#{@challenge.time_limit}"%> minutes to cook.</h2>
    <h2><%= button_to "Let's Get Choppin'!", "/users/#{current_user.id}/challenges/#{@challenge.id}/update", params: {game_event: "playing"}, method: :patch %></h2>
  </main>

<% elsif @challenge.game_status == "playing" %>
  <main class="game-play-main">
    <h2>You're making <%="#{@challenge.meal_type}"%>!</h2>
    <h1>Here are your mystery basket contents!</h1>
    <h2><% @challenge.basket_contents.each do |ingredient|%></h2>
      <section id=ingredient-"<%= ingredient.id %>">
        <h2><%= ingredient.name %></h2>
      </section>
    <% end %>
  </main>

<h3>Countdown Clock</h3> 
<div id="clockdiv"> 
  <div> 
    <span class="hours" id="hour"></span> 
    <div class="smalltext">Hours</div> 
  </div> 
  <div> 
    <span class="minutes" id="minute"></span> 
    <div class="smalltext">Minutes</div> 
  </div> 
  <div> 
    <span class="seconds" id="second"></span> 
    <div class="smalltext">Seconds</div> 
  </div> 
</div> 

<p id="demo"></p> 

<div id="num-field">
    <p>Start The Clock</p>

    <label for="num">Mintues:</label>
    <input id="inputNumber" type="number">
    <button onclick="myFunction() " id="submitButton" type="submit">submit</button>

</div>

<script>
  function myFunction() {
    document.querySelector("#num-field").setAttribute("id", "hidden"); 
    document.querySelector("#navbar").setAttribute("id", "hidden"); 
  }
</script>

<script>
  var submitButton = document.querySelector("#submitButton")

  submitButton.addEventListener('click', () => {
    
    var num = document.querySelector("#inputNumber").value
  var personInput = (Number(num)*60) * 1000

  var deadline = new Date(Date.now() + personInput).getTime();
  var x = setInterval(function() { 
    
    var now = new Date().getTime(); 

  var t = deadline - now; 
  
  var hours = Math.floor((t%(1000 * 60 * 60 * 24))/(1000 * 60 * 60)); 
  var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60)); 
  var seconds = Math.floor((t % (1000 * 60)) / 1000); 

  document.getElementById("hour").innerHTML =hours; 
  document.getElementById("minute").innerHTML = minutes;  
  document.getElementById("second").innerHTML =seconds;  
  if (t < 0) { 
    clearInterval(x); 
          document.getElementById("demo").innerHTML = "TIME'S UP";  
          document.getElementById("hour").innerHTML ='0'; 
          document.getElementById("minute").innerHTML ='0' ;  
          document.getElementById("second").innerHTML = '0'; } 
  }, 1000);

    })
    </script>
    <br><br>

    <button onclick="myHints() " id="hintButton" type="submit">Request Recipe Hints</button><br><br>
      <div class="hints" id="hidden">
      Hints<br><br>
      ALL the Hints<br><br>
      HINTS ON HINTS
      </div>
    <script>
    function myHints() {
      document.querySelector(".hints").setAttribute("id", "unhidden"); 
    }
    </script>
    <br><br><br>
    <%= button_to "Recipe Book", "/users/hints", method: :get %><br><br><br>
        
    <%= button_to "Cancel Game", "/users/#{current_user.id}/challenges/#{@challenge.id}/update", params: {game_event: "cancel"}, method: :patch %><br><br><br>
    <%= button_to "I Finished Early!", "/users/#{current_user.id}/challenges/#{@challenge.id}/update", params: {game_event: "done"}, method: :patch %><br><br><br>


  <% elsif @challenge.game_status == "cancelled" %>
    <main class="game-cancelled-main">
      <h2>This game has been cancelled.</h2>
      <h2>Click here for recipe ideas using your basket ingredients.</h2>
      <h2><h2>Would you like to try again with a fresh basket?</h2></h2>
      <h2><%= button_to "Start New Game", "/users/#{current_user.id}/challenges/new", method: :get %></h2><br>
      <h2>Would you like to change your pantry ingredients?</h2>
      <h2><%= button_to "Your Pantry", "/users/#{current_user.id}/ingredients", method: :get %></h2>
    </main>

  <% elsif @challenge.game_status == "done" %>
    <main class="game-done-main">
      <h2>Congratulations!!</h2>
      <h2>You did it! Share photo of your creation below!</h2>
      <h2><%= form_tag "/users/#{current_user.id}/challenges/update", params: {game_event: "save_photo"}, method: :patch do %>
        <%= label_tag :photo %>
        <%= text_field_tag :photo %>
        <%= submit_tag "Save Photo"  %>
      <% end %><br></h2>
      <h2><%= button_to "Don't Save a Photo", "/users/#{current_user.id}/challenges/#{@challenge.id}/update", params: {game_event: "no_photo"}, method: :patch %></h2><br>
    </main>

  <% elsif @challenge.game_status == "complete" %>
    <main class="game-complete-main">
      <h1>Here Are Your Game Results!!</h1>
      <h2>You had a <%= @challenge.time_limit %> minute challenge.</h2>
      <h2>You were challenged to make a <%= @challenge.meal_type %>.</h2>
      <h2>Your Mystery Basket Ingredients Were:</h2>
      <% @challenge.ingredients.each do |ingredient|%>
          <section id=final_ingredient-"<%= ingredient.id %>">
            <h3><%= ingredient.name %></h3>
          </section>
          <% end %>
      <h2><h2>Would you like play again with a fresh basket?</h2></h2>
      <h2><%= button_to "Start New Game", "/users/#{current_user.id}/challenges/new", method: :get %></h2><br>
      <h2>Would you like to change your pantry ingredients?</h2>
      <h2><%= button_to "Your Pantry", "/users/#{current_user.id}/ingredients", method: :get %></h2>
      <h2><%= button_to "Your Dashboard", "/users/#{current_user.id}/dashboard", method: :get %></h2>
    </main>

  <% else %>
<% end %>
